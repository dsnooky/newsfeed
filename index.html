<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trending News Philippines</title>
<style>
/* Reset and basic styling */
body {font-family: Arial,sans-serif; margin:0; background:#f4f4f4; color:#333;}
header {background:#007bff;color:white;padding:20px;text-align:center;}
header h1 {margin:0;font-size:1.8rem;}
main {padding:15px; max-width:1200px; margin:auto;}
h2 {margin-bottom:10px;}

/* Top Stories & Entertainment */
.top-news-container, .top-ent-container {display:flex; gap:15px; flex-wrap:wrap; opacity:0; transform:translateY(20px); animation:fadeSlide 0.8s forwards;}
.top-card {background:white; border-radius:10px; overflow:hidden; box-shadow:0 2px 12px rgba(0,0,0,0.1); flex:1 1 calc(33% - 15px); transition: transform 0.3s, box-shadow 0.3s; opacity:0; animation:fadeIn 0.5s forwards;}
.top-card img {width:100%; height:180px; object-fit:cover;}
.top-card-content {padding:10px;}
.top-card-content h3 {margin:0 0 8px; font-size:1rem;}
.top-card-content p {font-size:0.75rem; color:#555;}
.top-card-content a {display:inline-block; margin-top:5px; color:#007bff; text-decoration:none; font-weight:bold;}
.top-card-content a:hover {text-decoration:underline;}
.top-card:hover {transform:translateY(-5px); box-shadow:0 5px 20px rgba(0,0,0,0.15);}

/* Search Bar */
.search-bar {margin:15px 0; text-align:center;}
.search-bar input {width:90%; max-width:500px; padding:10px; border-radius:5px; border:1px solid #ccc; font-size:1rem;}

/* Tabs */
.tabs {display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; justify-content:center;}
.tab {padding:8px 15px; background:#e0e0e0; border-radius:5px; cursor:pointer; transition:0.3s;}
.tab.active {background:#007bff; color:white;}

/* News Grid */
.news-container {display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px;}
.news-card {background:white; border-radius:10px; box-shadow:0 2px 12px rgba(0,0,0,0.1); overflow:hidden; transition: transform 0.3s, box-shadow 0.3s; opacity:0; animation:fadeIn 0.5s forwards;}
.news-card img {width:100%; height:150px; object-fit:cover;}
.news-card-content {padding:10px;}
.news-card-content h3 {margin:0 0 8px; font-size:1rem;}
.news-card-content p {font-size:0.75rem; color:#555;}
.news-card-content a {display:inline-block; margin-top:5px; color:#007bff; text-decoration:none; font-weight:bold;}
.news-card-content a:hover {text-decoration:underline;}
.news-card:hover {transform:translateY(-5px); box-shadow:0 5px 20px rgba(0,0,0,0.15);}

/* Footer */
footer {text-align:center; padding:15px; background:#007bff; color:white; margin-top:30px; font-size:0.85rem;}

/* Animations */
@keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
@keyframes fadeSlide {from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);}}

@media(max-width:768px){
    .top-card {flex:1 1 48%;}
    .news-card img {height:130px;}
}

@media(max-width:480px){
    .top-card {flex:1 1 100%;}
    .news-card img {height:120px;}
}
</style>
</head>
<body>

<header>
<h1>Trending News Philippines</h1>
<p>Aggregated news from multiple sources</p>
</header>

<main>
<!-- Top Trending News -->
<div class="top-news" id="top-news">
<h2>Trending Top Stories</h2>
<div class="top-news-container" id="top-news-container">
<p>Loading top stories...</p>
</div>
</div>

<!-- Top Entertainment News -->
<div class="top-entertainment" id="top-entertainment">
<h2>Top Entertainment News</h2>
<div class="top-ent-container" id="top-ent-container">
<p>Loading entertainment news...</p>
</div>
</div>

<!-- Search Bar -->
<div class="search-bar">
<input type="text" id="search-input" placeholder="Search news...">
</div>

<!-- Category Tabs -->
<div class="tabs" id="tabs">
<div class="tab active" data-category="All">All</div>
<div class="tab" data-category="Politics">Politics</div>
<div class="tab" data-category="Entertainment">Entertainment</div>
<div class="tab" data-category="Sports">Sports</div>
<div class="tab" data-category="Technology">Technology</div>
</div>

<!-- News Grid -->
<div class="news-container" id="news-container">
<p>Loading news...</p>
</div>
</main>

<footer>
&copy; 2026 Trending News PH
</footer>

<script>
// RSS feeds
const rssFeeds = [
{name: 'Inquirer', url: 'https://www.inquirer.net/feed'},
{name: 'Philippine Star', url: 'https://www.philstar.com/rss'},
{name: 'GMA News', url: 'https://www.gmanetwork.com/news/rss/'},
{name: 'Rappler', url: 'https://www.rappler.com/rss'},
{name: 'Philippine Entertainment', url: 'https://www.pep.ph/rss/news/1'}
];

const newsContainer = document.getElementById('news-container');
const topNewsContainer = document.getElementById('top-news-container');
const topEntContainer = document.getElementById('top-ent-container');
const searchInput = document.getElementById('search-input');
const tabs = document.querySelectorAll('.tab');

let allArticles = [];
let filteredArticles = [];
let articlesLoaded = 0;
const articlesPerBatch = 10;

// Extract image from content
function extractImageFromContent(html) {
    if (!html) return null;
    const imgMatch = html.match(/<img.*?src="(.*?)"/);
    return imgMatch ? imgMatch[1] : null;
}

// Category detection
function getCategory(title) {
    const lower = title.toLowerCase();
    if (lower.includes('politic')) return 'Politics';
    if (lower.includes('entertainment') || lower.includes('showbiz') || lower.includes('celebrity')) return 'Entertainment';
    if (lower.includes('sport') || lower.includes('basketball') || lower.includes('football')) return 'Sports';
    if (lower.includes('tech') || lower.includes('technology') || lower.includes('gadgets')) return 'Technology';
    return 'All';
}

// Browser caching
function saveCache() { localStorage.setItem('newsCache', JSON.stringify(allArticles)); }
function loadCache() { 
    const cache = localStorage.getItem('newsCache');
    if(cache) allArticles = JSON.parse(cache);
}

// Fetch all feeds in parallel
async function fetchNews() {
    loadCache(); // show cached first
    displayTopStories();
    displayTopEntertainment();
    applyFilters();

    const feedPromises = rssFeeds.map(feed => {
        const rss2jsonUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`;
        return fetch(rss2jsonUrl)
        .then(res => res.json())
        .catch(err => {console.error(feed.name, err); return {items:[]};});
    });

    const results = await Promise.all(feedPromises);
    allArticles = [];

    results.forEach(data => {
        data.items.forEach(item => {
            let image = item.enclosure?.link || item.thumbnail || extractImageFromContent(item.content);
            if(!image) return; // skip if no image
            let category = getCategory(item.title);
            allArticles.push({
                title: item.title,
                link: item.link,
                pubDate: new Date(item.pubDate),
                image: image,
                category: category
            });
        });
    });

    allArticles.sort((a,b) => b.pubDate - a.pubDate);
    saveCache();
    displayTopStories();
    displayTopEntertainment();
    applyFilters();
}

// Display top 3 stories
function displayTopStories() {
    topNewsContainer.innerHTML = '';
    const top3 = allArticles.slice(0,3);
    top3.forEach((article,index) => {
        const card = document.createElement('div');
        card.classList.add('top-card');
        card.style.animationDelay = `${index*0.1}s`;
        card.innerHTML = `
            <img src="${article.image}" alt="News Image" loading="lazy">
            <div class="top-card-content">
                <h3>${article.title}</h3>
                <p>${article.pubDate.toLocaleString()} | ${article.category}</p>
                <a href="${article.link}" target="_blank">Read More</a>
            </div>
        `;
        topNewsContainer.appendChild(card);
    });
}

// Display top 3 entertainment stories
function displayTopEntertainment() {
    topEntContainer.innerHTML = '';
    const entArticles = allArticles.filter(a => a.category === 'Entertainment').slice(0,3);
    entArticles.forEach((article,index) => {
        const card = document.createElement('div');
        card.classList.add('top-card');
        card.style.animationDelay = `${index*0.1}s`;
        card.innerHTML = `
            <img src="${article.image}" alt="Entertainment Image" loading="lazy">
            <div class="top-card-content">
                <h3>${article.title}</h3>
                <p>${article.pubDate.toLocaleString()}</p>
                <a href="${article.link}" target="_blank">Read More</a>
            </div>
        `;
        topEntContainer.appendChild(card);
    });
}

// Infinite scroll
function displayNextBatch() {
    const toDisplay = filteredArticles.slice(articlesLoaded, articlesLoaded + articlesPerBatch);
    toDisplay.forEach((article,index) => {
        const card = document.createElement('div');
        card.classList.add('news-card');
        card.style.animationDelay = `${index*0.05}s`;
        card.innerHTML = `
            <img src="${article.image}" alt="News Image" loading="lazy">
            <div class="news-card-content">
                <h3>${article.title}</h3>
                <p>${article.pubDate.toLocaleString()} | ${article.category}</p>
                <a href="${article.link}" target="_blank">Read More</a>
            </div>
        `;
        newsContainer.appendChild(card);
    });
    articlesLoaded += toDisplay.length;
}

// Apply filters
function applyFilters() {
    const activeTab = document.querySelector('.tab.active').dataset.category;
    const query = searchInput.value.toLowerCase();
    filteredArticles = allArticles.filter(a => 
        (activeTab === 'All' || a.category === activeTab) &&
        a.title.toLowerCase().includes(query)
    );
    newsContainer.innerHTML = '';
    articlesLoaded = 0;
    displayNextBatch();
}

// Scroll event
window.addEventListener('scroll', () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
        if (articlesLoaded < filteredArticles.length) displayNextBatch();
    }
});

// Tabs
tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        applyFilters();
    });
});

// Search
searchInput.addEventListener('input', applyFilters);

// Initial fetch
fetchNews();

// Auto-refresh every 5 minutes
setInterval(fetchNews, 300000);
</script>
</body>
</html>
